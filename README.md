# IP归属地查询插件

一个功能强大的AstrBot插件，用于查询IP地址的地理位置信息，支持多API备份和智能故障转移。

## 🌟 功能特性

- **双源查询**：支持52vmy.cn、vvhan.com两个免费API（支持IPv4与IPv6）
- **智能故障转移**：主API失败时自动切换备用API
- **详细地理位置**：提供国家、地区、城市、ISP等完整信息
- **坐标信息**：包含经纬度坐标和时区信息
- **用户友好**：支持查询指定IPv4/IPv6和当前IP
- **异步处理**：高效的异步网络请求处理
- **错误处理**：完善的异常捕获和重试机制

## 📦 安装方法

1. 进入AstrBot插件目录：
   ```bash
   cd data/plugins
   ```

2. 克隆或下载插件：
   ```bash
   git clone https://github.com/cloudcranesss/astrbot_plugin_ip_lookup.git
   # 或手动下载并解压到该目录
   ```

3. 重启AstrBot，插件将自动加载

## 🚀 使用方法

### 使用方法

#### 命令格式

- `ip [IP地址]` - 查询指定IP的归属地

### 使用示例

#### 查询指定IP
支持IPv4和IPv6地址查询。

**IPv4查询：**
```
ip 8.8.8.8
```

**IPv6查询：**
```
ip 2001:4860:4860::8888
```

返回示例：
```
📍 IP地址：8.8.8.8
🏳️ 国家：美国
🗺️ 地区：加利福尼亚州
🏙️ 城市：山景城
🏢 ISP：Google LLC
📍 坐标：37.4056, -122.0775
🕐 时区：America/Los_Angeles
```



## ⚙️ 技术优化

### 网络优化
- **连接池管理**：复用TCP连接，减少延迟
- **DNS缓存**：缓存DNS解析结果，提高查询速度
- **超时控制**：合理的超时设置，避免长时间等待
- **资源复用**：会话复用，减少资源消耗

### 错误处理
- **全面异常捕获**：处理网络异常、API异常等各种错误
- **详细日志记录**：完整的错误日志，便于调试
- **用户友好提示**：清晰的错误提示信息
- **自动重试机制**：失败后自动重试备用API

### 性能提升
- **异步处理**：所有网络请求均为异步
- **并发限制**：合理的并发数控制
- **内存优化**：及时清理不再使用的资源

## 📋 更新日志

### v1.2.0
- ✅ 优化客户端IP获取逻辑
- ✅ 增强错误处理和日志记录
- ✅ 改进超时和异常处理
- ✅ 插件重命名为ip_location

### v1.1.0
- ✅ 精简为52vmy.cn和vvhan.com双API架构
- ✅ 移除ip-api.com API依赖
- ✅ 优化API调用顺序

### v1.0.0
- ✅ 初始版本发布
- ✅ 实现基本IP查询功能
- ✅ 支持命令组模式
- ✅ 完善错误处理机制

## ⚠️ 注意事项

1. **IP格式**：请确保输入的是有效的IPv4地址格式
2. **查询限制**：部分免费API有查询频率限制
3. **准确性**：地理位置信息仅供参考，可能存在误差
4. **隐私保护**：不会记录或存储用户的IP信息

## 🛠️ 开发计划

- [ ] 支持IPv6地址查询
- [ ] 添加更多备用API
- [ ] 支持批量IP查询
- [ ] 添加地理位置地图展示
- [ ] 支持自定义API密钥

## 🤝 支持与反馈

- **GitHub Issues**: [提交问题](https://github.com/cloudcranesss/astrbot_plugin_ip_lookup/issues)

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 🙏 致谢

- 感谢52vmy.cn和vvhan.com提供的免费API服务
- 感谢AstrBot框架提供的优秀插件系统
- 感谢所有贡献者和用户的支持

---

**Made with ❤️ by cloudcranesss**